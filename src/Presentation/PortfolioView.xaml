<Window x:Class="Presentation.PortfolioView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Portfolio" Width="900" Height="580"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource App.Background}">
    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240"/>
            <ColumnDefinition Width="12"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Portfolios -->
        <StackPanel>
            <TextBlock Text="Portfolios" FontSize="18" FontWeight="Bold" Margin="0,0,0,8"/>
            <ListBox ItemsSource="{Binding Portfolios}" SelectedItem="{Binding Selected}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Name}"/>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </StackPanel>

        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="180"/>
                <RowDefinition Height="8"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Summary -->
            <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,8">
                <TextBlock Text="Summary:" FontWeight="Bold" Margin="0,0,8,0"/>
                <TextBlock Text="{Binding Summary.TotalMarketValue, StringFormat=C}" Margin="0,0,8,0"/>
                <TextBlock Text="Cost:" Margin="16,0,4,0"/>
                <TextBlock Text="{Binding Summary.TotalCost, StringFormat=C}" Margin="0,0,8,0"/>
                <TextBlock Text="P/L:" Margin="16,0,4,0"/>
                <TextBlock Text="{Binding Summary.GainLoss, StringFormat=C}"/>
                <TextBlock Text="{Binding Summary.GainLossPct, StringFormat=' ({0:F2}%)'}" Margin="4,0,0,0"/>
                <Button Content="Refresh" Command="{Binding RefreshCmd}" Margin="16,0,0,0" />
            </StackPanel>

            <!-- Holdings grid -->
            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Holdings" FontWeight="Bold" Margin="0,0,0,6"/>
                <DataGrid Grid.Row="1" ItemsSource="{Binding Holdings}" AutoGenerateColumns="False" CanUserAddRows="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Ticker" Binding="{Binding Ticker}" Width="100"/>
                        <DataGridTextColumn Header="Shares" Binding="{Binding Shares}" Width="100"/>
                        <DataGridTextColumn Header="Cost (Total)" Binding="{Binding CostBasis, StringFormat=C}" Width="120"/>
                    </DataGrid.Columns>
                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Remove" Command="{Binding DataContext.RemoveHoldingCmd, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding}"/>
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                </DataGrid>

                <!-- Add holding (pure WPF: labels + textboxes, no PlaceholderText) -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,6,0,0" VerticalAlignment="Center">
                    <StackPanel Orientation="Vertical" Margin="0,0,6,0">
                        <TextBlock Text="Ticker" Opacity="0.7" FontSize="11"/>
                        <TextBox Width="90" Text="{Binding NewTicker, UpdateSourceTrigger=PropertyChanged}" />
                    </StackPanel>
                    <StackPanel Orientation="Vertical" Margin="0,0,6,0">
                        <TextBlock Text="Shares" Opacity="0.7" FontSize="11"/>
                        <TextBox Width="90" Text="{Binding NewShares, UpdateSourceTrigger=PropertyChanged}" />
                    </StackPanel>
                    <StackPanel Orientation="Vertical" Margin="0,0,6,0">
                        <TextBlock Text="Cost (Total)" Opacity="0.7" FontSize="11"/>
                        <TextBox Width="120" Text="{Binding NewCost, UpdateSourceTrigger=PropertyChanged}" />
                    </StackPanel>
                    <Button Content="Add" Command="{Binding AddHoldingCmd}" VerticalAlignment="Bottom" />
                </StackPanel>
            </Grid>

            <!-- Allocation list -->
            <StackPanel Grid.Row="3">
                <TextBlock Text="Allocation" FontWeight="Bold" Margin="0,0,0,6"/>
                <ItemsControl ItemsSource="{Binding Allocation}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Ticker}" Width="80"/>
                                <ProgressBar Width="220" Height="14" Minimum="0" Maximum="100" Value="{Binding WeightPct}" Margin="6,0,6,0"/>
                                <TextBlock Text="{Binding WeightPct, StringFormat={}{0:F1}%}" Width="60"/>
                                <TextBlock Text="{Binding MarketValue, StringFormat=C}" Width="100"/>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
